/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   RESET
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   TOKENS
   DARK: nearly black bg so glass shows through clearly
   LIGHT: soft lavender bg so glass picks up colour
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
:root,[data-theme="dark"]{
  --bg:          #06000f;
  --lav:         #c4b5fd;
  --lav-dim:     rgba(196,181,253,.55);
  --lav-border:  rgba(210,195,255,.28);
  --lav-glow:    rgba(196,181,253,.12);

  /* Glass fill — almost nothing, just a lavender whisper */
  --glass:       rgba(196,181,253,.055);
  --glass-h:     rgba(196,181,253,.09);

  /* Specular — the bright top highlight */
  --spec:        rgba(255,255,255,.60);
  --spec-mid:    rgba(255,255,255,.08);

  --txt:         rgba(245,240,255,.95);
  --txt-d:       rgba(196,181,253,.65);
  --modal-bg:    rgba(10,5,28,.93);
  --rain:        196,181,253;
}
[data-theme="light"]{
  --bg:          #cdc5f0;
  --lav:         #6d28d9;
  --lav-dim:     rgba(109,40,217,.55);
  --lav-border:  rgba(109,40,217,.28);
  --lav-glow:    rgba(109,40,217,.10);

  /* Light mode glass — more white, slight lavender */
  --glass:       rgba(255,255,255,.32);
  --glass-h:     rgba(255,255,255,.50);
  --spec:        rgba(255,255,255,.85);
  --spec-mid:    rgba(255,255,255,.22);

  --txt:         rgba(12,4,36,.94);
  --txt-d:       rgba(80,40,160,.68);
  --modal-bg:    rgba(242,238,255,.97);
  --rain:        90,50,180;
}
@media(prefers-color-scheme:light){[data-theme="system"]{
  --bg:#cdc5f0;--lav:#6d28d9;--lav-dim:rgba(109,40,217,.55);
  --lav-border:rgba(109,40,217,.28);--lav-glow:rgba(109,40,217,.10);
  --glass:rgba(255,255,255,.32);--glass-h:rgba(255,255,255,.50);
  --spec:rgba(255,255,255,.85);--spec-mid:rgba(255,255,255,.22);
  --txt:rgba(12,4,36,.94);--txt-d:rgba(80,40,160,.68);
  --modal-bg:rgba(242,238,255,.97);--rain:90,50,180;
}}
@media(prefers-color-scheme:dark){[data-theme="system"]{
  --bg:#06000f;--lav:#c4b5fd;--lav-dim:rgba(196,181,253,.55);
  --lav-border:rgba(210,195,255,.28);--lav-glow:rgba(196,181,253,.12);
  --glass:rgba(196,181,253,.055);--glass-h:rgba(196,181,253,.09);
  --spec:rgba(255,255,255,.60);--spec-mid:rgba(255,255,255,.08);
  --txt:rgba(245,240,255,.95);--txt-d:rgba(196,181,253,.65);
  --modal-bg:rgba(10,5,28,.93);--rain:196,181,253;
}}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   BASE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
html{font-size:16px;-webkit-text-size-adjust:100%}
body{
  min-height:100vh;background:var(--bg);
  font-family:'DM Mono',monospace;
  display:flex;align-items:center;justify-content:center;
  overflow-x:hidden;transition:background .45s ease;
}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   HEX RINGS + RAIN
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.hex-rings{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.hex-rings svg{position:absolute;left:-52%;top:50%;transform:translateY(-50%);width:110vh;height:110vh}
.hex-ring{fill:none;stroke:rgba(196,181,253,.15);stroke-width:1.2;transform-origin:50% 50%;animation:rp 3.5s ease-out infinite}
[data-theme="light"] .hex-ring{stroke:rgba(109,40,217,.12)}
.hex-ring:nth-child(1){animation-delay:0s}   .hex-ring:nth-child(2){animation-delay:.4s}
.hex-ring:nth-child(3){animation-delay:.8s}  .hex-ring:nth-child(4){animation-delay:1.2s}
.hex-ring:nth-child(5){animation-delay:1.6s} .hex-ring:nth-child(6){animation-delay:2s}
.hex-ring:nth-child(7){animation-delay:2.4s} .hex-ring:nth-child(8){animation-delay:2.8s}
@keyframes rp{0%{opacity:0;transform:scale(.55)}15%{opacity:1}80%{opacity:.06}100%{opacity:0;transform:scale(1.55)}}
#rain{position:fixed;inset:0;z-index:1;pointer-events:none}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   THEME BUTTONS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.theme-panel{position:fixed;right:14px;top:50%;transform:translateY(-50%);z-index:50;display:flex;flex-direction:column;gap:8px}
.theme-btn{
  width:34px;height:34px;border-radius:50%;
  border:1px solid var(--lav-border);
  background:var(--glass);
  backdrop-filter:blur(30px) saturate(180%);
  -webkit-backdrop-filter:blur(30px) saturate(180%);
  box-shadow:0 1px 0 var(--spec) inset,0 4px 14px rgba(0,0,0,.3);
  color:var(--txt);font-size:.85rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:background .2s,transform .15s;
}
.theme-btn:hover{background:var(--glass-h);transform:scale(1.1)}
.theme-btn.active{border-color:var(--lav);box-shadow:0 0 0 2px var(--lav),0 1px 0 var(--spec) inset}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   GRID
   5 cols × 3 rows
   R1: Cal(1-3) | Lib(3-5) | Anniv(5, r1-2)
   R2: Streak(1) | Time(2) | Grad(3) | Water(4) | [anniv]
   R3: Music(1-3) | Moon(3-5) | Fox(5)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
main{
  position:relative;z-index:10;isolation:isolate;
  width:92%;max-width:950px;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:auto auto auto;
  gap:10px;padding:20px 0;
}
.card-calendar  {grid-column:1/3;grid-row:1}
.card-library   {grid-column:3/5;grid-row:1;cursor:pointer}
.card-anniv     {grid-column:5/6;grid-row:1/3}
.card-streak-sq {grid-column:1/2;grid-row:2}
.card-time-sq   {grid-column:2/3;grid-row:2}
.card-grad-sq   {grid-column:3/4;grid-row:2}
.card-water     {grid-column:4/5;grid-row:2;cursor:pointer}
.card-music     {grid-column:1/3;grid-row:3}
.card-moon      {grid-column:3/5;grid-row:3}
.card-fox       {grid-column:5/6;grid-row:3}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ✦ LIQUID GLASS CARD ✦
   
   The recipe (matching Apple/Divided reference):
   1. Near-transparent fill with lavender tint
   2. backdrop-filter: blur(64px) saturate(220%) — the core
   3. Bright white top specular via box-shadow inset + ::before gradient
   4. Visible border with lavender tint
   5. Bottom dark inset for "thickness"
   6. Subtle outer lavender glow
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card{
  background:var(--glass);
  border:1px solid var(--lav-border);
  border-radius:20px;
  padding:14px 18px;

  /* THE core glass blur — must be strong to pick up background colour */
  backdrop-filter:blur(64px) saturate(220%) brightness(1.05);
  -webkit-backdrop-filter:blur(64px) saturate(220%) brightness(1.05);

  box-shadow:
    /* ① bright top rim — the most important visible cue */
    0 1.5px 0 0 var(--spec) inset,
    /* ② faint side catches */
    1px 0 0 0 rgba(255,255,255,.07) inset,
    -1px 0 0 0 rgba(255,255,255,.07) inset,
    /* ③ bottom inner shadow — makes glass feel thick */
    0 -2px 8px 0 rgba(0,0,0,.22) inset,
    /* ④ outer lavender glow ring */
    0 0 0 1px var(--lav-glow),
    /* ⑤ soft drop shadow */
    0 8px 30px rgba(0,0,0,.35),
    0 2px 8px rgba(0,0,0,.20);

  position:relative;overflow:hidden;
  transition:background .3s,box-shadow .3s;
}

/* TOP FROSTED GRADIENT — the "foggy glass" band at the top */
.card::before{
  content:'';
  position:absolute;top:0;left:0;right:0;height:46%;
  background:linear-gradient(
    180deg,
    var(--spec)     0%,
    var(--spec-mid) 30%,
    transparent     100%
  );
  pointer-events:none;border-radius:20px 20px 0 0;z-index:1;
}

/* BOTTOM LIP */
.card::after{
  content:'';
  position:absolute;bottom:0;left:6%;right:6%;height:1px;
  background:rgba(0,0,0,.22);pointer-events:none;
}

.card:hover{
  background:var(--glass-h);
  box-shadow:
    0 2px 0 0 var(--spec) inset,
    1px 0 0 0 rgba(255,255,255,.10) inset,
    -1px 0 0 0 rgba(255,255,255,.10) inset,
    0 -2px 8px 0 rgba(0,0,0,.18) inset,
    0 0 0 1px var(--lav-glow),
    0 12px 40px rgba(0,0,0,.42),
    0 4px 12px rgba(0,0,0,.26);
}

/* Lift all children above ::before overlay */
.card>*{position:relative;z-index:2}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   TYPOGRAPHY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.label{font-size:.48rem;letter-spacing:.18em;text-transform:uppercase;color:var(--txt-d);margin-bottom:5px;display:block}
.stat-num{font-family:'DM Serif Display',serif;font-size:clamp(1.35rem,2.3vw,1.95rem);color:var(--txt);line-height:1;animation:gp 4s ease-in-out infinite;display:block}
.stat-unit{font-family:'DM Mono',monospace;font-size:.42rem;color:var(--lav);letter-spacing:.14em;text-transform:uppercase;margin-top:2px;display:block}
@keyframes gp{0%,100%{text-shadow:0 0 8px rgba(196,181,253,.25)}50%{text-shadow:0 0 18px rgba(196,181,253,.55)}}
[data-theme="light"] .stat-num{animation:none}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   SQUARE CARDS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-sq{aspect-ratio:1;padding:10px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:3px}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   TIME
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.time-sq{font-family:'DM Serif Display',serif;font-size:clamp(.9rem,1.55vw,1.25rem);color:var(--txt);line-height:1;white-space:nowrap;letter-spacing:-.02em;display:flex;align-items:baseline;animation:gp 4s ease-in-out infinite}
.time-sq .amOrPm{font-family:'DM Mono',monospace;font-size:.36rem;color:var(--lav);letter-spacing:.1em;margin-left:2px;align-self:center}
[data-theme="light"] .time-sq{animation:none}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   CALENDAR (30% smaller = tighter padding + smaller fonts)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-calendar{padding:11px 15px}
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:2px}
.cal-month-year{font-size:.50rem;color:var(--lav);letter-spacing:.1em;text-transform:uppercase}
.cal-date-display{margin-bottom:4px}
.cal-date-display .date{font-size:.48rem;color:var(--txt-d);letter-spacing:.03em}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:1.5px}
.cal-day-name{font-size:.34rem;letter-spacing:.05em;text-transform:uppercase;color:var(--txt-d);text-align:center;padding-bottom:2px}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:.44rem;color:var(--txt-d);border-radius:4px;position:relative;cursor:pointer;transition:background .15s}
.cal-day:hover{background:rgba(196,181,253,.1)}
[data-theme="light"] .cal-day:hover{background:rgba(109,40,217,.08)}
.cal-day.dot-day{color:var(--txt)}
.cal-day.dot-day::after{content:'';position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:2.5px;height:2.5px;border-radius:50%;background:var(--lav)}
.cal-day.stroke-day{border:1px solid var(--lav-border)}
.cal-day.today{background:rgba(196,181,253,.16)!important;color:var(--txt)!important;border:1px solid rgba(196,181,253,.4)!important;border-radius:6px}
[data-theme="light"] .cal-day.today{background:rgba(109,40,217,.13)!important;border-color:rgba(109,40,217,.35)!important}
.cal-day.has-note::before{content:'';position:absolute;top:1px;right:2px;width:2.5px;height:2.5px;border-radius:50%;background:var(--lav)}
.cal-day.empty{opacity:0;pointer-events:none}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   LIBRARY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-library{display:flex;flex-direction:column;justify-content:space-between}
.library-inner{display:flex;align-items:center;gap:10px;flex:1;margin:6px 0}
.lib-icon{font-size:1.8rem;filter:drop-shadow(0 0 10px var(--lav));flex-shrink:0}
.library-info{flex:1}
.book-title{font-family:'DM Serif Display',serif;font-size:.84rem;color:var(--txt);line-height:1.2;margin-bottom:6px}
.progress-bar{height:3px;background:rgba(128,128,128,.14);border-radius:10px}
.progress-fill{width:60%;height:100%;background:var(--lav);border-radius:10px}
.progress-label{font-size:.42rem;color:var(--txt-d);letter-spacing:.12em;text-transform:uppercase;margin-top:4px;display:block}
.mini-shelf{display:flex;gap:4px;margin-top:5px}
.spine{width:10px;height:34px;border-radius:3px;opacity:.85;transition:opacity .2s,transform .2s}
.spine:hover{opacity:1;transform:translateY(-3px)}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ANNIVERSARY (spans rows 1+2)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-anniv{display:flex;flex-direction:column;gap:5px;cursor:pointer}

.anniv-slide-wrap{
  flex:1;border-radius:12px;overflow:hidden;
  background:rgba(196,181,253,.05);
  border:1px solid var(--lav-border);
  display:flex;align-items:center;justify-content:center;
  min-height:0;position:relative;
}
.anniv-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;padding:8px}
.anniv-hint{font-size:.42rem;color:var(--txt-d);letter-spacing:.1em;text-transform:uppercase;text-align:center}
.anniv-img{width:100%;height:100%;object-fit:cover;display:block;transition:opacity .5s ease}
.anniv-img.hidden{display:none}
.anniv-nav{
  position:absolute;top:50%;transform:translateY(-50%);
  background:rgba(0,0,0,.3);border:none;color:#fff;font-size:1rem;
  padding:3px 7px;border-radius:6px;cursor:pointer;opacity:0;
  transition:opacity .2s;z-index:3;
}
.anniv-slide-wrap:hover .anniv-nav{opacity:1}
.anniv-prev{left:4px}.anniv-next{right:4px}
.anniv-dots{display:flex;gap:4px;justify-content:center;flex-shrink:0}
.anniv-dot{width:5px;height:5px;border-radius:50%;background:var(--lav-border);transition:background .3s;cursor:pointer}
.anniv-dot.on{background:var(--lav)}
.anniv-footer{flex-shrink:0;text-align:center}
.anniv-years{font-family:'DM Serif Display',serif;font-size:clamp(1.4rem,2.2vw,1.9rem);color:var(--txt);line-height:1;display:block;animation:gp 4s ease-in-out infinite}
[data-theme="light"] .anniv-years{animation:none}
.anniv-unit{font-size:.40rem;color:var(--lav);letter-spacing:.14em;text-transform:uppercase;display:block;margin-top:2px}
.anniv-date{font-size:.44rem;color:var(--txt-d);letter-spacing:.08em;display:block;margin-top:3px}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   WATER WIDGET
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-water{aspect-ratio:1;padding:10px;display:flex;flex-direction:column;gap:3px}
.water-body{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;width:100%}
.water-glass-wrap{flex:1;display:flex;align-items:center;justify-content:center;width:100%}

/* The glass / cup */
.water-glass{
  width:34px;height:52px;
  border:1.5px solid rgba(147,197,253,.55);
  border-top:none;
  border-radius:2px 2px 6px 6px;
  position:relative;overflow:hidden;
  background:rgba(147,197,253,.04);
}
[data-theme="light"] .water-glass{border-color:rgba(60,120,220,.4)}

.water-fill{
  position:absolute;bottom:0;left:0;right:0;
  height:0%; /* driven by JS */
  background:linear-gradient(180deg,rgba(147,197,253,.35) 0%,rgba(100,160,255,.55) 100%);
  transition:height 1.2s cubic-bezier(.22,.68,0,1.2);
}
.water-wave{
  position:absolute;top:-4px;left:-100%;width:300%;height:8px;
  background:rgba(255,255,255,.3);
  border-radius:50%;
  animation:ww 2s linear infinite;
}
@keyframes ww{0%{transform:translateX(0)}100%{transform:translateX(33.3%)}}

/* Drip drop */
.water-drip{
  position:absolute;top:-12px;left:50%;transform:translateX(-50%);
  width:5px;height:7px;background:rgba(147,197,253,.9);
  border-radius:50% 50% 60% 60%;
  opacity:0;
}
.water-drip.dripping{animation:drip .7s ease-in forwards}
@keyframes drip{
  0%  {opacity:1;top:-8px}
  80% {opacity:1}
  100%{opacity:0;top:100%}
}

.water-shine{
  position:absolute;top:4px;left:5px;width:4px;height:60%;
  background:rgba(255,255,255,.2);border-radius:2px;pointer-events:none;
}

.water-stats{display:flex;align-items:baseline;gap:2px;flex-shrink:0}
.water-oz{font-family:'DM Serif Display',serif;font-size:.9rem;color:var(--txt)}
.water-oz-label{font-size:.38rem;color:var(--txt-d);letter-spacing:.07em}
.water-mini-bar{width:32px;height:2px;background:rgba(128,128,128,.15);border-radius:10px;position:absolute;bottom:10px;left:50%;transform:translateX(-50%)}
.water-mini-fill{height:100%;width:0%;background:var(--lav);border-radius:10px;transition:width .8s ease}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   MUSIC
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-music{display:flex;flex-direction:column;gap:7px}
.music-inner{display:flex;align-items:center;gap:10px;flex:1}
.music-art{width:44px;height:44px;border-radius:8px;background:var(--glass);border:1px solid var(--lav-border);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;overflow:hidden}
.music-art img{width:100%;height:100%;object-fit:cover}
.music-info{flex:1;min-width:0}
.music-track{font-family:'DM Serif Display',serif;font-size:.78rem;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}
.music-artist{font-size:.44rem;color:var(--txt-d);letter-spacing:.1em;margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.music-bar{height:3px;background:rgba(128,128,128,.14);border-radius:10px;cursor:pointer}
.music-bar-fill{height:100%;width:0%;background:var(--lav);border-radius:10px;transition:width .25s linear}
.music-time{font-size:.40rem;color:var(--txt-d);display:block;margin-top:3px}
.music-controls{display:flex;align-items:center;gap:5px}
.music-btn{background:rgba(255,255,255,.06);border:1px solid var(--lav-border);border-radius:7px;color:var(--txt);font-size:.68rem;cursor:pointer;padding:4px 7px;transition:background .2s;line-height:1}
.music-btn:hover{background:var(--glass-h)}
.music-play{background:rgba(196,181,253,.10);border-color:var(--lav)}
.music-vol{flex:1;height:3px;-webkit-appearance:none;appearance:none;background:rgba(128,128,128,.14);border-radius:10px;outline:none;cursor:pointer}
.music-vol::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;border-radius:50%;background:var(--lav);cursor:pointer}
.music-vol::-moz-range-thumb{width:10px;height:10px;border-radius:50%;background:var(--lav);cursor:pointer;border:none}
.music-upload{background:rgba(255,255,255,.05);border:1px solid var(--lav-border);border-radius:7px;color:var(--lav);font-size:.58rem;cursor:pointer;padding:4px 7px;white-space:nowrap;font-family:'DM Mono',monospace}
.music-upload:hover{background:var(--glass-h)}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   MOON
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-moon{display:flex;flex-direction:column;gap:6px}
.moon-inner{display:flex;align-items:center;gap:14px;flex:1}
.moon-canvas{border-radius:50%;flex-shrink:0}
.moon-info{flex:1}
.moon-name{font-family:'DM Serif Display',serif;font-size:.95rem;color:var(--txt);line-height:1.2;margin-bottom:4px}
.moon-detail{font-size:.50rem;color:var(--txt-d);letter-spacing:.06em;line-height:1.65}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   FOX
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.card-fox{padding:8px;gap:4px;cursor:pointer}
.fox-wrap{flex:1;width:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:10px}
.fox-wrap img{width:100%;height:100%;object-fit:cover;border-radius:10px}
.fox-emoji{font-size:2rem;animation:po 1.5s ease-in-out infinite}
@keyframes po{0%,100%{opacity:.5}50%{opacity:1}}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ✦ LIQUID GLASS MODALS ✦
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.52);
  display:flex;justify-content:center;align-items:center;
  opacity:0;pointer-events:none;
  transition:opacity .26s ease;
  z-index:100;padding:20px;
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
}
[data-theme="light"] .modal-overlay{background:rgba(100,70,200,.28)}
.modal-overlay.open{opacity:1;pointer-events:auto}

.modal-glass{
  width:min(520px,100%);max-height:84vh;
  /* Glass fill */
  background:var(--modal-bg);
  border:1px solid var(--lav-border);
  border-radius:22px;
  padding:26px;overflow-y:auto;position:relative;

  /* Glass effect on the modal itself */
  backdrop-filter:blur(60px) saturate(200%);
  -webkit-backdrop-filter:blur(60px) saturate(200%);
  box-shadow:
    0 1.5px 0 var(--spec) inset,
    1px 0 0 rgba(255,255,255,.06) inset,
    -1px 0 0 rgba(255,255,255,.06) inset,
    0 -2px 8px rgba(0,0,0,.22) inset,
    0 0 0 1px var(--lav-glow),
    0 20px 60px rgba(0,0,0,.62),
    0 6px 18px rgba(0,0,0,.38);
}
.modal-glass::before{
  content:'';
  position:absolute;top:0;left:0;right:0;height:40%;
  background:linear-gradient(180deg,var(--spec) 0%,var(--spec-mid) 28%,transparent 100%);
  pointer-events:none;border-radius:22px 22px 0 0;z-index:0;
}
.modal-glass>*{position:relative;z-index:1}
.modal-sm{width:min(420px,100%)}

.modal-x{
  position:absolute;top:14px;right:16px;z-index:3;
  background:rgba(255,255,255,.07);border:1px solid var(--lav-border);
  border-radius:50%;width:27px;height:27px;
  color:var(--txt-d);font-size:.78rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:background .2s,color .2s;
}
.modal-x:hover{background:rgba(255,255,255,.14);color:var(--txt)}

.modal-title{font-family:'DM Serif Display',serif;font-size:1.22rem;color:var(--txt);margin-bottom:14px;padding-right:28px}
.sec-label{font-size:.44rem;letter-spacing:.16em;text-transform:uppercase;color:var(--txt-d);display:block;margin-bottom:6px}

/* Form elements */
.mi{
  flex:1;background:rgba(255,255,255,.07);border:1px solid var(--lav-border);
  border-radius:9px;padding:6px 10px;font-family:'DM Mono',monospace;
  font-size:.60rem;color:var(--txt);outline:none;transition:border-color .2s;min-width:0;
}
[data-theme="light"] .mi{background:rgba(255,255,255,.55)}
.mi::placeholder{color:var(--txt-d);opacity:.65}
.mi:focus{border-color:var(--lav)}
.mb{
  background:rgba(196,181,253,.10);border:1px solid var(--lav-border);
  border-radius:9px;padding:6px 11px;font-family:'DM Mono',monospace;
  font-size:.58rem;color:var(--lav);cursor:pointer;white-space:nowrap;flex-shrink:0;
  transition:background .2s;
}
.mb:hover{background:rgba(196,181,253,.22)}
.mta{
  width:100%;background:rgba(255,255,255,.07);border:1px solid var(--lav-border);
  border-radius:9px;padding:9px 11px;font-family:'DM Mono',monospace;
  font-size:.60rem;color:var(--txt);outline:none;resize:vertical;
  min-height:80px;transition:border-color .2s;line-height:1.6;display:block;
  margin-bottom:10px;
}
[data-theme="light"] .mta{background:rgba(255,255,255,.55)}
.mta::placeholder{color:var(--txt-d);opacity:.6}
.mta:focus{border-color:var(--lav)}
.row-gap{display:flex;gap:7px;align-items:center}

/* Book grid */
.book-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(108px,1fr));gap:9px;margin-top:4px}
.book-card{
  background:rgba(255,255,255,.06);border:1px solid var(--lav-border);
  padding:10px;border-radius:10px;font-size:.64rem;color:var(--txt);
  font-family:'DM Mono',monospace;transition:background .2s,transform .2s;
  cursor:pointer;line-height:1.4;
}
[data-theme="light"] .book-card{background:rgba(255,255,255,.50)}
.book-card:hover{background:rgba(255,255,255,.12);transform:translateY(-3px)}
[data-theme="light"] .book-card:hover{background:rgba(255,255,255,.70)}

/* Book detail */
.bk-header{display:flex;gap:14px;align-items:flex-start;margin-bottom:14px}
.bk-cover{width:76px;height:112px;border-radius:6px;flex-shrink:0;background:rgba(255,255,255,.06);border:1px solid var(--lav-border);display:flex;align-items:center;justify-content:center;font-size:1.7rem;overflow:hidden}
.bk-cover img{width:100%;height:100%;object-fit:cover}
.bk-meta{flex:1}
.bk-title{font-family:'DM Serif Display',serif;font-size:1.12rem;color:var(--txt);line-height:1.2;margin-bottom:4px}
.bk-author{font-size:.56rem;color:var(--txt-d);letter-spacing:.1em;margin-bottom:10px}
.star-row{display:flex;gap:4px;margin-bottom:9px}
.star{font-size:1rem;color:rgba(196,181,253,.2);cursor:pointer;transition:color .15s,transform .15s}
.star:hover,.star.on{color:var(--lav);filter:drop-shadow(0 0 4px var(--lav))}
.star:hover{transform:scale(1.2)}
.link-row{display:flex;gap:7px}
.bk-summary{font-size:.60rem;color:var(--txt-d);line-height:1.75;border-top:1px solid var(--lav-border);padding-top:12px}

/* Reminders */
.reminder-item{display:flex;align-items:center;gap:7px;background:rgba(255,255,255,.04);border:1px solid var(--lav-border);border-radius:7px;padding:6px 9px;font-size:.58rem;color:var(--txt);margin-bottom:5px}
[data-theme="light"] .reminder-item{background:rgba(255,255,255,.42)}
.rdot{width:4px;height:4px;border-radius:50%;background:var(--lav);flex-shrink:0}
.rdel{margin-left:auto;background:none;border:none;color:var(--txt-d);cursor:pointer;font-size:.7rem;transition:color .2s}
.rdel:hover{color:#ff6b8a}

/* Water modal */
.water-log-today{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.water-big{font-family:'DM Serif Display',serif;font-size:1.4rem;color:var(--txt)}
.water-big-unit{font-size:.65rem;color:var(--txt-d)}
.water-hist{display:flex;flex-direction:column;gap:5px;max-height:180px;overflow-y:auto;margin-top:4px}
.whist-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.04);border:1px solid var(--lav-border);border-radius:7px;padding:6px 10px;font-size:.56rem;color:var(--txt-d)}
[data-theme="light"] .whist-item{background:rgba(255,255,255,.42)}
.whist-item strong{color:var(--txt)}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   MOBILE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
@media(max-width:680px){
  body{align-items:flex-start;overflow-y:auto;padding-bottom:80px}
  main{grid-template-columns:1fr 1fr;width:95%;padding:10px 0;gap:8px;grid-template-rows:auto}
  .card-calendar,.card-library,.card-anniv,.card-music,.card-moon{grid-column:1/3;grid-row:auto}
  .card-streak-sq,.card-time-sq,.card-grad-sq,.card-water,.card-fox{grid-column:span 1;grid-row:auto}
  .card-anniv{min-height:220px}
  .theme-panel{flex-direction:row;right:auto;bottom:16px;top:auto;left:50%;transform:translateX(-50%)}
  .hex-rings{display:none}
}
@media(max-width:380px){
  main{grid-template-columns:1fr}
  .card-calendar,.card-library,.card-anniv,.card-streak-sq,.card-time-sq,
  .card-grad-sq,.card-water,.card-music,.card-moon,.card-fox{grid-column:1/2}
}
